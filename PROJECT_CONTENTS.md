# RSPI LocalServer ‚Äì Project Contents

This document lists all files in the RSPI LocalServer project and their purposes.

## File Tree

```
RSPI_LocalServer/
‚îú‚îÄ‚îÄ README.md                     # Full documentation & feature overview
‚îú‚îÄ‚îÄ QUICKSTART.md                 # 30-second quick-start guide
‚îú‚îÄ‚îÄ DEPLOYMENT.md                 # Step-by-step deployment checklist
‚îú‚îÄ‚îÄ ARCHITECTURE.md               # Design, module breakdown, security model
‚îú‚îÄ‚îÄ PROJECT_CONTENTS.md           # This file
‚îÇ
‚îú‚îÄ‚îÄ .gitignore                    # Git ignore patterns
‚îú‚îÄ‚îÄ requirements.txt              # Python dependencies (minimal, ~5 packages)
‚îÇ
‚îú‚îÄ‚îÄ app/                          # Main application package
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py               # Package marker
‚îÇ   ‚îú‚îÄ‚îÄ main.py                   # FastAPI app (routes, middleware)
‚îÇ   ‚îú‚îÄ‚îÄ config.py                 # Configuration loader (singleton)
‚îÇ   ‚îú‚îÄ‚îÄ file_manager.py           # File operations & path safety
‚îÇ   ‚îî‚îÄ‚îÄ static/
‚îÇ       ‚îî‚îÄ‚îÄ index.html            # Web UI (single HTML file, responsive)
‚îÇ
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ config.yaml               # Default configuration template
‚îÇ
‚îú‚îÄ‚îÄ scripts/                      # Placeholder for systemd service (generated by install.sh)
‚îÇ
‚îú‚îÄ‚îÄ install.sh                    # Installation script (sudo required)
‚îú‚îÄ‚îÄ update.sh                     # Update script with backup & restart
‚îî‚îÄ‚îÄ uninstall.sh                  # Uninstall script (safe, keeps logs/config)
```

## File Descriptions

### Documentation

#### `README.md` (~500 lines)
**Full reference documentation covering:**
- Features overview
- System requirements
- Installation steps (Python setup, USB mounting, app install)
- Configuration (YAML options, secrets)
- Service management (systemctl commands)
- API endpoints reference
- Security notes
- Performance characteristics
- Troubleshooting guide
- FAQ

**Audience:** Users, system administrators, developers

**When to use:** First-time setup, configuration reference, troubleshooting

---

#### `QUICKSTART.md` (~100 lines)
**Fast setup guide (30 seconds):**
- Prerequisites checklist
- Installation one-liner
- Basic commands
- USB drive setup
- Auth enablement
- Common issues

**Audience:** Impatient users who just want to get it running

**When to use:** Initial deployment on fresh Pi

---

#### `DEPLOYMENT.md` (~400 lines)
**Step-by-step deployment checklist:**
- Pre-deployment checks
- OS preparation
- USB storage setup (auto-mount or manual)
- Installation verification
- Feature testing
- Boot persistence verification
- Monitoring & maintenance
- Troubleshooting matrix
- Security checklist
- Performance expectations

**Audience:** System administrators, home users

**When to use:** First deployment, refer during setup

---

#### `ARCHITECTURE.md` (~600 lines)
**Technical design document:**
- Design principles & philosophy
- Technology stack rationale
- Project structure & modules
- Module breakdown (config, file_manager, main, UI)
- Data flow examples
- Security threat model & defenses
- Performance characteristics & limits
- Scalability & extension points
- Testing approach
- Deployment architecture

**Audience:** Developers, advanced users, maintainers

**When to use:** Understanding implementation, extending features, security review

---

#### `PROJECT_CONTENTS.md` (This file)
**Project file listing & quick reference**

---

### Application Code

#### `app/__init__.py` (~5 lines)
**Package marker with metadata**
- Version: 1.0.0
- Author attribution

**Why:** Makes `app/` a Python package; allows `from app import ...`

---

#### `app/main.py` (~200 lines)
**FastAPI application entry point**

**Defines:**
- FastAPI app instance
- CORS middleware (LAN access)
- HTTP Basic Auth verification
- API routes:
  - `GET /` ‚Äì Serve UI (index.html)
  - `GET /api/config` ‚Äì UI config
  - `GET /api/browse` ‚Äì List directory
  - `POST /api/upload` ‚Äì Upload file
  - `POST /api/mkdir` ‚Äì Create folder
  - `POST /api/rename` ‚Äì Rename item
  - `POST /api/delete` ‚Äì Delete item
  - `GET /api/download` ‚Äì Download file
  - `GET /health` ‚Äì Health check

**Key Features:**
- Dependency injection for auth (`verify_auth`)
- FileResponse for downloads (streaming)
- JSON responses for API calls
- Error handling (401, 404, 400, 500)

**Run as:** Entry point for Gunicorn: `gunicorn app.main:app`

---

#### `app/config.py` (~100 lines)
**Configuration management system**

**Classes:**
- `Config` ‚Äì Singleton pattern, lazy-loads YAML

**Methods:**
- `load(path)` ‚Äì Load from YAML file
- `get(key, default)` ‚Äì Dot-notation access (e.g., `"server.port"`)

**Behavior:**
- Searches multiple locations (dev, /etc, home)
- Falls back to defaults if missing
- Caches after first load
- Integrates with FastAPI dependency injection via `get_config()`

**Why Singleton?** Ensure single config instance across app; prevent reloading

---

#### `app/file_manager.py` (~350 lines)
**File operations & security**

**Classes:**

**`PathValidator`**
- Purpose: Prevent directory traversal attacks
- Key method: `safe_path(user_path)` ‚Üí absolute path or None
- Algorithm: Resolve path, verify within base_path, return None if outside
- Tests: Blocks `../../etc/passwd`, `~`, `/etc`, etc.

**`FileManager`**
- Purpose: Safe file I/O with business logic
- Methods:
  - `list_directory(path)` ‚Üí dict with folders, files, metadata
  - `create_folder(path, name)` ‚Üí bool
  - `rename_item(path, new_name)` ‚Üí bool
  - `delete_item(path)` ‚Üí bool
  - `upload_file(path, name, bytes)` ‚Üí bool
  - `get_file_path(path)` ‚Üí Path or None (for download)

**Security:**
- All paths validated via PathValidator
- Filenames sanitized (remove `/`, `\`)
- File size checked
- Extension whitelist (optional)
- Permission errors caught

**Errors logged but don't crash** (returns False/None instead of exception)

---

#### `app/static/index.html` (~1000 lines)
**Single-file responsive web UI**

**Sections:**

**CSS (~200 lines)**
- Gradient background (purple)
- Header with breadcrumb
- Toolbar with buttons
- File list with icons
- Modal dialogs (styled with overlay)
- Responsive media queries for mobile
- Colors: purple (#667eea, #764ba2), white, grays

**HTML (~100 lines)**
- Structure: header, toolbar, alerts, file list, modals
- No JavaScript framework, vanilla DOM
- Three modals: mkdir, rename, delete confirmation

**JavaScript (~700 lines)**
- Global state: `currentPath`, `selectedItem`
- API functions: `fetch()` for all endpoints
- UI functions: `renderFileList()`, `updateBreadcrumb()`, etc.
- Event handlers: click, keypress, form submission
- Utilities: path escaping, size formatting, file icons

**Features:**
- Real-time file list (no page refresh)
- Breadcrumb navigation
- Folder open, file download
- Single/batch upload (preserves folder structure)
- Create, rename, delete with confirmation
- Toast alerts (auto-hide)
- Mobile-friendly layout

**No build required:** Works directly in any modern browser

---

### Configuration

#### `config/config.yaml` (~30 lines)
**Default configuration template**

**Copied to `/etc/rspi-localserver/config.yaml` on install**

**Sections:**
- `server:` ‚Äì Host, port, workers, timeouts
- `storage:` ‚Äì Base path, upload limits, extension whitelist
- `auth:` ‚Äì Enable/disable, username/password
- `ui:` ‚Äì Title, refresh interval
- `logging:` ‚Äì Level, format

**All values documented with inline comments**

---

### Installation Scripts

#### `install.sh` (~150 lines, bash)
**Automated installation for Raspberry Pi**

**Prerequisites:**
- Run as root (`sudo bash install.sh`)
- Python 3, pip installed

**Actions:**
1. Create application user `rspi` (unprivileged)
2. Create directories: `/opt/rspi-localserver`, `/etc/rspi-localserver`, `/var/log/rspi-localserver`, `/media/usb`
3. Copy application files to `/opt/rspi-localserver`
4. Copy config to `/etc/rspi-localserver/config.yaml`
5. Create Python venv, install dependencies
6. Generate systemd service file
7. Set permissions (rspi user owns app directories)
8. Enable and start service
9. Verify service is running
10. Print setup summary

**Output:**
```
‚úÖ Installation successful!
üìç Service: rspi-localserver
üìÇ App directory: /opt/rspi-localserver
‚öôÔ∏è  Config: /etc/rspi-localserver/config.yaml
üìã Logs: /var/log/rspi-localserver/
```

**Safety:**
- Creates user if doesn't exist
- Copies (doesn't move) files (safe to re-run)
- Sets restrictive permissions (640 for config)

---

#### `update.sh` (~100 lines, bash)
**Safe update with automatic rollback**

**Prerequisites:**
- Run as root (`sudo bash update.sh`)
- App already installed

**Actions:**
1. Verify installation exists
2. Stop service
3. Backup current `/opt/rspi-localserver` to `/opt/rspi-localserver-backup-<timestamp>`
4. Copy new app files
5. Update Python dependencies
6. Restart service
7. Verify service is running
8. On failure: Rollback from backup

**Output:**
```
üîÑ Updating rspi-localserver...
üíæ Backing up current installation...
Backup saved to: /opt/rspi-localserver-backup-20240101-123456

‚úÖ Update successful!
```

**Benefits:**
- Automatic rollback on failure
- Keeps config (not overwritten)
- Prints backup location for reference

---

#### `uninstall.sh` (~80 lines, bash)
**Safe uninstall, keeps data for reference**

**Prerequisites:**
- Run as root (`sudo bash uninstall.sh`)
- Confirms action interactively

**Actions:**
1. Prompt user for confirmation
2. Stop and disable service
3. Remove systemd service file
4. Remove application code
5. Keep `/etc/rspi-localserver` (config reference)
6. Keep `/var/log/rspi-localserver` (logs reference)
7. Prompt user to manually remove above if desired

**Output:**
```
‚ö†Ô∏è  Uninstalling rspi-localserver...
This will:
  - Stop the rspi-localserver service
  - Remove application files from /opt/rspi-localserver
  - Remove systemd service
  - Keep config files at /etc/rspi-localserver (for reference)
  - Keep logs at /var/log/rspi-localserver (for reference)
  - Keep the rspi user account
  - Keep /media/usb mount point

Continue? (yes/no): 
```

**Safety:**
- Asks for confirmation
- Doesn't auto-delete user account
- Preserves config & logs for reference

---

### Version Control

#### `.gitignore` (~40 lines)
**Git ignore patterns**

**Ignores:**
- `__pycache__/`, `*.pyc` (Python bytecode)
- `venv/`, `env/` (virtual environments)
- `.vscode/`, `.idea/` (IDE config)
- `*.log` (logs)
- `.env` (secrets)
- `*.backup` (backup files)

**Why:** Keep repo clean, no secrets committed

---

### Dependency Management

#### `requirements.txt` (~6 lines)
**Python package dependencies**

```
fastapi==0.104.1              # Web framework
gunicorn==21.2.0              # WSGI server
uvicorn[standard]==0.24.0     # ASGI worker + HTTP server
python-multipart==0.0.6       # Multipart form parsing (for file upload)
pyyaml==6.0.1                 # YAML config parsing
python-dotenv==1.0.0          # Load .env file (optional)
```

**All pinned to specific versions for reproducibility**

**Total size:** ~15 MB on disk (after pip install)

---

## File Size Summary

| File | Lines | Size |
|------|-------|------|
| app/main.py | 200 | ~6 KB |
| app/config.py | 100 | ~3 KB |
| app/file_manager.py | 350 | ~12 KB |
| app/static/index.html | 1000 | ~40 KB |
| config/config.yaml | 30 | ~1 KB |
| install.sh | 150 | ~5 KB |
| update.sh | 100 | ~4 KB |
| uninstall.sh | 80 | ~3 KB |
| requirements.txt | 6 | ~200 B |
| **Total (code)** | ~2000 | ~74 KB |
| README.md | 500 | ~20 KB |
| DEPLOYMENT.md | 400 | ~18 KB |
| ARCHITECTURE.md | 600 | ~25 KB |
| QUICKSTART.md | 100 | ~4 KB |
| **Total (docs)** | ~1600 | ~67 KB |
| **Total (all)** | ~3600 | ~141 KB |

---

## Installation Footprint

After `sudo bash install.sh`:

```
/opt/rspi-localserver/
  app/                     ~50 KB (code + static HTML)
  venv/                    ~80 MB (Python 3.9 + packages)
  requirements.txt         ~200 B
  Total: ~80 MB

/etc/rspi-localserver/
  config.yaml              ~1 KB
  Total: ~1 KB

/var/log/rspi-localserver/
  (empty initially)        ~0 KB

System overhead (rspi user, cgroups, etc.): <1 MB

TOTAL INSTALLED: ~81 MB (mostly venv)
MEMORY AT RUNTIME: 50‚Äì150 MB (depending on load)
```

---

## Quick Reference

### View Logs
```bash
sudo tail -f /var/log/rspi-localserver/error.log
sudo journalctl -u rspi-localserver -f
```

### Edit Config
```bash
sudo nano /etc/rspi-localserver/config.yaml
sudo systemctl restart rspi-localserver
```

### Update
```bash
cd ~/RSPI_LocalServer && sudo bash update.sh
```

### Uninstall
```bash
cd ~/RSPI_LocalServer && sudo bash uninstall.sh
```

### Access UI
```
http://<pi-ip>:8080
```

---

## Summary

**RSPI LocalServer** is a **complete, production-ready file manager** packaged in:
- **4 Python modules** (~650 lines, well-commented)
- **1 HTML file** (~1000 lines, responsive UI)
- **3 shell scripts** (~330 lines, installation/update/uninstall)
- **4 markdown docs** (~1600 lines, comprehensive)
- **1 config file** (YAML, human-editable)
- **1 requirements file** (6 pinned packages)

**Total code footprint:** ~141 KB (docs + code)
**Installed size:** ~81 MB (mostly Python venv)
**Runtime memory:** 50‚Äì150 MB

**Perfect for:** Raspberry Pi 4B (1GB+ RAM) as a home file server on LAN.

---

For any questions, see the appropriate doc:
- **Setup?** ‚Üí [QUICKSTART.md](QUICKSTART.md)
- **Deploy?** ‚Üí [DEPLOYMENT.md](DEPLOYMENT.md)
- **How does it work?** ‚Üí [ARCHITECTURE.md](ARCHITECTURE.md)
- **Reference?** ‚Üí [README.md](README.md)
